import{m as fe,f as ve,y as be,e as ke,v as Ie,T as _e,h as X,c as B,d as Le,g as ze}from"./msgTip-a00a6396.js";import{bV as Ce,i as Y,b as me,d as se,c as ue,f as J,b_ as ce,g as pe,r as y,bw as Ee,s as Te,h,l as le,V as ge,o as we,m as b,B as oe,K as c,C as z,q as p,v as d,u as t,x as re,G as k,E as S,am as Oe,n as x,J as ie,aa as Se,ab as xe,b$ as Ne,c0 as Re,F as $e,c1 as Ae,c2 as Xe,R as Ye,D as Be,t as K,aI as Ve,_ as ye,c3 as Me,c4 as De,k as Fe,y as he,O as Pe,S as He,aM as We,L as je,I as Ze,X as qe}from"./index-d45ed081.js";import{d as Ge}from"./index-b06f2c24.js";var Ke="Expected a function";function ne(s,o,n){var l=!0,g=!0;if(typeof s!="function")throw new TypeError(Ke);return Ce(n)&&(l="leading"in n?!!n.leading:l,g="trailing"in n?!!n.trailing:g),Ge(s,o,{leading:l,maxWait:o,trailing:g})}const Je=(s,o)=>{if(!Y||!s||!o)return!1;const n=s.getBoundingClientRect();let l;return o instanceof Element?l=o.getBoundingClientRect():l={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},n.top<l.bottom&&n.bottom>l.top&&n.right>l.left&&n.left<l.right},de=s=>{let o=0,n=s;for(;n;)o+=n.offsetTop,n=n.offsetParent;return o},pt=(s,o)=>Math.abs(de(s)-de(o)),gt=s=>{let o,n;return s.type==="touchend"?(n=s.changedTouches[0].clientY,o=s.changedTouches[0].clientX):s.type.startsWith("touch")?(n=s.touches[0].clientY,o=s.touches[0].clientX):(n=s.clientY,o=s.clientX),{clientX:o,clientY:n}},Ue=me({urlList:{type:se(Array),default:()=>fe([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:{type:Boolean,default:!1},teleported:{type:Boolean,default:!1},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),Qe={close:()=>!0,switch:s=>ue(s)},et=["src"],tt=J({name:"ElImageViewer"}),at=J({...tt,props:Ue,emits:Qe,setup(s,{expose:o,emit:n}){const l=s,g={CONTAIN:{name:"contain",icon:ce(Me)},ORIGINAL:{name:"original",icon:ce(De)}},{t:C}=ve(),i=pe("image-viewer"),{nextZIndex:U}=be(),N=y(),I=y([]),_=Ee(),L=y(!0),f=y(l.initialIndex),v=Te(g.CONTAIN),u=y({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),V=h(()=>{const{urlList:e}=l;return e.length<=1}),R=h(()=>f.value===0),W=h(()=>f.value===l.urlList.length-1),Q=h(()=>l.urlList[f.value]),M=h(()=>{const{scale:e,deg:a,offsetX:r,offsetY:m,enableTransition:T}=u.value;let w=r/e,O=m/e;switch(a%360){case 90:case-270:[w,O]=[O,-w];break;case 180:case-180:[w,O]=[-w,-O];break;case 270:case-90:[w,O]=[-O,w];break}const A={transform:`scale(${e}) rotate(${a}deg) translate(${w}px, ${O}px)`,transition:T?"transform .3s":""};return v.value.name===g.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),ee=h(()=>ue(l.zIndex)?l.zIndex:U());function $(){te(),n("close")}function D(){const e=ne(r=>{switch(r.code){case X.esc:l.closeOnPressEscape&&$();break;case X.space:P();break;case X.left:q();break;case X.up:E("zoomIn");break;case X.right:G();break;case X.down:E("zoomOut");break}}),a=ne(r=>{const m=r.deltaY||r.deltaX;E(m<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});_.run(()=>{B(document,"keydown",e),B(document,"wheel",a)})}function te(){_.stop()}function ae(){L.value=!1}function j(e){L.value=!1,e.target.alt=C("el.image.error")}function Z(e){if(L.value||e.button!==0||!N.value)return;u.value.enableTransition=!1;const{offsetX:a,offsetY:r}=u.value,m=e.pageX,T=e.pageY,w=ne(A=>{u.value={...u.value,offsetX:a+A.pageX-m,offsetY:r+A.pageY-T}}),O=B(document,"mousemove",w);B(document,"mouseup",()=>{O()}),e.preventDefault()}function F(){u.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function P(){if(L.value)return;const e=Fe(g),a=Object.values(g),r=v.value.name,T=(a.findIndex(w=>w.name===r)+1)%e.length;v.value=g[e[T]],F()}function H(e){const a=l.urlList.length;f.value=(e+a)%a}function q(){R.value&&!l.infinite||H(f.value-1)}function G(){W.value&&!l.infinite||H(f.value+1)}function E(e,a={}){if(L.value)return;const{zoomRate:r,rotateDeg:m,enableTransition:T}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...a};switch(e){case"zoomOut":u.value.scale>.2&&(u.value.scale=Number.parseFloat((u.value.scale/r).toFixed(3)));break;case"zoomIn":u.value.scale<7&&(u.value.scale=Number.parseFloat((u.value.scale*r).toFixed(3)));break;case"clockwise":u.value.deg+=m;break;case"anticlockwise":u.value.deg-=m;break}u.value.enableTransition=T}return le(Q,()=>{ge(()=>{const e=I.value[0];e!=null&&e.complete||(L.value=!0)})}),le(f,e=>{F(),n("switch",e)}),we(()=>{var e,a;D(),(a=(e=N.value)==null?void 0:e.focus)==null||a.call(e)}),o({setActiveItem:H}),(e,a)=>(b(),oe(Ve,{to:"body",disabled:!e.teleported},[c(_e,{name:"viewer-fade",appear:""},{default:z(()=>[p("div",{ref_key:"wrapper",ref:N,tabindex:-1,class:d(t(i).e("wrapper")),style:re({zIndex:t(ee)})},[p("div",{class:d(t(i).e("mask")),onClick:a[0]||(a[0]=ke(r=>e.hideOnClickModal&&$(),["self"]))},null,2),k(" CLOSE "),p("span",{class:d([t(i).e("btn"),t(i).e("close")]),onClick:$},[c(t(S),null,{default:z(()=>[c(t(Oe))]),_:1})],2),k(" ARROW "),t(V)?k("v-if",!0):(b(),x(ie,{key:0},[p("span",{class:d([t(i).e("btn"),t(i).e("prev"),t(i).is("disabled",!e.infinite&&t(R))]),onClick:q},[c(t(S),null,{default:z(()=>[c(t(Se))]),_:1})],2),p("span",{class:d([t(i).e("btn"),t(i).e("next"),t(i).is("disabled",!e.infinite&&t(W))]),onClick:G},[c(t(S),null,{default:z(()=>[c(t(xe))]),_:1})],2)],64)),k(" ACTIONS "),p("div",{class:d([t(i).e("btn"),t(i).e("actions")])},[p("div",{class:d(t(i).e("actions__inner"))},[c(t(S),{onClick:a[1]||(a[1]=r=>E("zoomOut"))},{default:z(()=>[c(t(Ne))]),_:1}),c(t(S),{onClick:a[2]||(a[2]=r=>E("zoomIn"))},{default:z(()=>[c(t(Re))]),_:1}),p("i",{class:d(t(i).e("actions__divider"))},null,2),c(t(S),{onClick:P},{default:z(()=>[(b(),oe($e(t(v).icon)))]),_:1}),p("i",{class:d(t(i).e("actions__divider"))},null,2),c(t(S),{onClick:a[3]||(a[3]=r=>E("anticlockwise"))},{default:z(()=>[c(t(Ae))]),_:1}),c(t(S),{onClick:a[4]||(a[4]=r=>E("clockwise"))},{default:z(()=>[c(t(Xe))]),_:1})],2)],2),k(" CANVAS "),p("div",{class:d(t(i).e("canvas"))},[(b(!0),x(ie,null,Ye(e.urlList,(r,m)=>Be((b(),x("img",{ref_for:!0,ref:T=>I.value[m]=T,key:r,src:r,style:re(t(M)),class:d(t(i).e("img")),onLoad:ae,onError:j,onMousedown:Z},null,46,et)),[[Ie,m===f.value]])),128))],2),K(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var nt=ye(at,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const st=he(nt),lt=me({hideOnClickModal:{type:Boolean,default:!1},src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:{type:Boolean,default:!1},scrollContainer:{type:se([String,Object])},previewSrcList:{type:se(Array),default:()=>fe([])},previewTeleported:{type:Boolean,default:!1},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),ot={load:s=>s instanceof Event,error:s=>s instanceof Event,switch:s=>ue(s),close:()=>!0,show:()=>!0},rt=["src","loading"],it={key:0},ut=J({name:"ElImage",inheritAttrs:!1}),ct=J({...ut,props:lt,emits:ot,setup(s,{emit:o}){const n=s;let l="";const{t:g}=ve(),C=pe("image"),i=Pe(),U=Le(),N=y(),I=y(!1),_=y(!0),L=y(!1),f=y(),v=y(),u=Y&&"loading"in HTMLImageElement.prototype;let V,R;const W=h(()=>i.style),Q=h(()=>{const{fit:e}=n;return Y&&e?{objectFit:e}:{}}),M=h(()=>{const{previewSrcList:e}=n;return Array.isArray(e)&&e.length>0}),ee=h(()=>{const{previewSrcList:e,initialIndex:a}=n;let r=a;return a>e.length-1&&(r=0),r}),$=h(()=>n.loading==="eager"?!1:!u&&n.loading==="lazy"||n.lazy),D=()=>{Y&&(_.value=!0,I.value=!1,N.value=n.src)};function te(e){_.value=!1,I.value=!1,o("load",e)}function ae(e){_.value=!1,I.value=!0,o("error",e)}function j(){Je(f.value,v.value)&&(D(),P())}const Z=qe(j,200);async function F(){var e;if(!Y)return;await ge();const{scrollContainer:a}=n;We(a)?v.value=a:je(a)&&a!==""?v.value=(e=document.querySelector(a))!=null?e:void 0:f.value&&(v.value=ze(f.value)),v.value&&(V=B(v,"scroll",Z),setTimeout(()=>j(),100))}function P(){!Y||!v.value||!Z||(V==null||V(),v.value=void 0)}function H(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function q(){M.value&&(R=B("wheel",H,{passive:!1}),l=document.body.style.overflow,document.body.style.overflow="hidden",L.value=!0,o("show"))}function G(){R==null||R(),document.body.style.overflow=l,L.value=!1,o("close")}function E(e){o("switch",e)}return le(()=>n.src,()=>{$.value?(_.value=!0,I.value=!1,P(),F()):D()}),we(()=>{$.value?F():D()}),(e,a)=>(b(),x("div",{ref_key:"container",ref:f,class:d([t(C).b(),e.$attrs.class]),style:re(t(W))},[N.value!==void 0&&!I.value?(b(),x("img",He({key:0},t(U),{src:N.value,loading:e.loading,style:t(Q),class:[t(C).e("inner"),t(M)&&t(C).e("preview"),_.value&&t(C).is("loading")],onClick:q,onLoad:te,onError:ae}),null,16,rt)):k("v-if",!0),_.value||I.value?(b(),x("div",{key:1,class:d(t(C).e("wrapper"))},[_.value?K(e.$slots,"placeholder",{key:0},()=>[p("div",{class:d(t(C).e("placeholder"))},null,2)]):I.value?K(e.$slots,"error",{key:1},()=>[p("div",{class:d(t(C).e("error"))},Ze(t(g)("el.image.error")),3)]):k("v-if",!0)],2)):k("v-if",!0),t(M)?(b(),x(ie,{key:2},[L.value?(b(),oe(t(st),{key:0,"z-index":e.zIndex,"initial-index":t(ee),infinite:e.infinite,"zoom-rate":e.zoomRate,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:G,onSwitch:E},{default:z(()=>[e.$slots.viewer?(b(),x("div",it,[K(e.$slots,"viewer")])):k("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):k("v-if",!0)],64)):k("v-if",!0)],6))}});var dt=ye(ct,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const wt=he(dt);export{wt as E,st as a,pt as b,gt as g,ne as t};
