/* empty css             *//* empty css                  */import{_ as O}from"./formDrawer-615cee08.js";/* empty css                *//* empty css                       *//* empty css                 *//* empty css                   *//* empty css                  *//* empty css                        *//* empty css                       *//* empty css                 */import"./el-form-item-4ed993c7.js";/* empty css                *//* empty css                      *//* empty css               *//* empty css                        *//* empty css                    *//* empty css                   */import{t as j}from"./tableHeader-f66fb168.js";import{b,E as J}from"./index-7aff1b23.js";import{u as Q,a as W}from"./useCommon-3fca7f65.js";import{F as X,E as Z}from"./msgTip-a00a6396.js";import{_ as ee}from"./_plugin-vue_export-helper-c27b6911.js";import{v as te}from"./directive-7bc345b5.js";import{a as oe,E as le}from"./index-4bd039ef.js";import{r as ae,o as ne,m as f,n as T,K as t,C as a,u as l,D as re,B as C,q as d,v as me,I as c,H as p,G as ie,a7 as se}from"./index-d45ed081.js";import{E as ue}from"./index-c440b37e.js";import{E as de}from"./index-61f461ba.js";import{a as pe,E as _e}from"./index-ae57328d.js";import{E as fe,b as ce}from"./index-83c7d896.js";import{E as be}from"./index-226dc19b.js";import{E as ge}from"./index-cd6b903f.js";import"./index-1cb0abaf.js";/* empty css                */import"./index-6998b886.js";import"./js.cookie-cf83ad76.js";import"./index-151d4a8e.js";import"./strings-5238cde9.js";import"./index-184e15d9.js";import"./_initCloneObject-4b55852b.js";import"./index-b06f2c24.js";import"./index-ebc90b42.js";import"./arrays-e667dc24.js";const ye=m=>b({url:`/coupon/${m}`,method:"get"}),ve=m=>b({url:"/coupon",method:"post",data:m}),Ve=(m,_)=>b({url:`/coupon/${m}`,method:"post",data:_}),Ce=m=>b({url:`/coupon/${m}/delete`,method:"post"}),xe=(m,_)=>b({url:`/coupon/${m}/update_status`,method:"post",data:{status:_}});const Ee={style:{"padding-right":"4px"}},he={key:0},De={__name:"list",setup(m){const _=ae([]),w={title:[{required:!0,message:"标题不能为空",trigger:"blur"}],content:[{required:!0,message:"内容不能为空",trigger:"blur"}]},{loading:R,tableData:x,total:E,changePage:U,getData:g,handleDel:h}=Q({del:Ce,getList:ye,onGetListSuccess:r=>{E.value=r.data.totalCount,x.value=r.data.list.map(o=>(o.statusText=z(o),o))}}),{formDrawerRef:$,formRef:I,isEdit:S,Form:n,handleCreate:B,handleEdit:A,onSubmit:N}=W({Form:{timeArray:null,name:"",type:0,value:0,total:0,min_price:0,start_time:null,end_time:null,order:50,desc:""},getData:g,add:ve,edit:Ve,beforeSubmit:r=>(r.start_time=new Date(r.timeArray[0]).getTime(),r.end_time=new Date(r.timeArray[1]).getTime(),r)}),z=r=>{let o="领取中",i=new Date(r.start_time).getTime(),u=new Date().getTime(),y=new Date(r.end_time).getTime();return i>u?o="未开始":y<u?o="已结束":r.status==0&&(o="已失效"),o},H=r=>{xe(r.id,r.status).then(o=>{g(),X("优惠券已失效",2e3,"success")})};return ne(()=>{g()}),(r,o)=>{const i=oe,u=se,y=ue,P=le,Y=de,q=J,v=Z,s=pe,D=fe,F=ce,V=be,G=ge,L=_e,M=O,K=te;return f(),T("div",null,[t(q,{shadow:"always"},{default:a(()=>[t(j,{layout:"create,refresh",onDelete:o[0]||(o[0]=e=>l(h)(_.value)),onCreate:l(B),onRefresh:l(g)},null,8,["onCreate","onRefresh"]),re((f(),C(P,{"max-height":"480px",data:l(x),stripe:"",style:{width:"100%"}},{default:a(()=>[t(i,{label:"优惠券名称",width:"300"},{default:a(({row:e})=>[d("div",{class:me(e.statusText=="领取中"?"coupon-item-active":"coupon-item")},[d("span",null,c(e.name),1),d("span",null,c(e.start_time)+" ~ "+c(e.end_time),1)],2)]),_:1}),t(i,{prop:"statusText",label:"状态",width:"200"}),t(i,{label:"优惠",width:"200"},{default:a(({row:e})=>[d("span",Ee,c(e.type==0?"满减":"折扣"),1),d("span",null,c(e.type==0?"￥"+e.value:e.value+"折扣"),1)]),_:1}),t(i,{prop:"total",label:"发放数量",width:"200"}),t(i,{prop:"used",label:"已使用 ",width:"80"}),t(i,{"table-column":"",fixed:"right",label:"操作",width:"200",align:"center"},{default:a(({row:e})=>[e.statusText!="领取中"?(f(),T("div",he,[e.statusText!="已结束"?(f(),C(u,{key:0,link:"",type:"primary",size:"small",onClick:k=>l(A)(e)},{default:a(()=>[p("编辑")]),_:2},1032,["onClick"])):ie("",!0),t(y,{title:"确认删除吗?","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:k=>l(h)(e.id)},{reference:a(()=>[t(u,{link:"",type:"primary",size:"small"},{default:a(()=>[p("删除")]),_:1})]),_:2},1032,["onConfirm"])])):(f(),C(y,{key:1,title:"让当前优惠券失效?","confirm-button-text":"确定","cancel-button-text":"取消",onConfirm:k=>H(e)},{reference:a(()=>[t(u,{type:"danger",size:"small"},{default:a(()=>[p("失效")]),_:1})]),_:2},1032,["onConfirm"]))]),_:1})]),_:1},8,["data"])),[[K,l(R)]]),t(Y,{small:"",background:"",layout:"prev, pager, next",total:l(E),onCurrentChange:l(U)},null,8,["total","onCurrentChange"])]),_:1}),t(M,{ref_key:"formDrawerRef",ref:$,title:l(S)?"编辑":"新增","confirm-text":"提交",destroyOnClose:"",onSubmit:l(N)},{default:a(()=>[t(L,{rules:w,ref_key:"formRef",ref:I,model:l(n),"status-icon":"","label-width":"auto"},{default:a(()=>[t(s,{label:"优惠券名称",prop:"name"},{default:a(()=>[t(v,{modelValue:l(n).name,"onUpdate:modelValue":o[1]||(o[1]=e=>l(n).name=e),placeholder:"请输入优惠券名称"},null,8,["modelValue"])]),_:1}),t(s,{label:"类型"},{default:a(()=>[t(F,{modelValue:l(n).type,"onUpdate:modelValue":o[2]||(o[2]=e=>l(n).type=e)},{default:a(()=>[t(D,{label:0},{default:a(()=>[p("满减")]),_:1}),t(D,{label:1},{default:a(()=>[p("折扣")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"面值"},{default:a(()=>[t(v,{modelValue:l(n).value,"onUpdate:modelValue":o[3]||(o[3]=e=>l(n).value=e),placeholder:"请输入面值",style:{width:"50%"}},{append:a(()=>[p("元")]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"发行量"},{default:a(()=>[t(V,{modelValue:l(n).total,"onUpdate:modelValue":o[4]||(o[4]=e=>l(n).total=e),min:0,max:1e3},null,8,["modelValue"])]),_:1}),t(s,{label:"最近使用价格"},{default:a(()=>[t(V,{modelValue:l(n).min_price,"onUpdate:modelValue":o[5]||(o[5]=e=>l(n).min_price=e),min:1,max:1e3,"controls-position":"right"},null,8,["modelValue"])]),_:1}),t(s,{label:"排序"},{default:a(()=>[t(V,{modelValue:l(n).order,"onUpdate:modelValue":o[6]||(o[6]=e=>l(n).order=e),min:0,max:1e3},null,8,["modelValue"])]),_:1}),t(s,{label:"活动时间"},{default:a(()=>[d("div",null,[t(G,{modelValue:l(n).timeArray,"onUpdate:modelValue":o[7]||(o[7]=e=>l(n).timeArray=e),type:"datetimerange","range-separator":"To",editable:!1,"start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])])]),_:1}),t(s,{label:"描述"},{default:a(()=>[t(v,{modelValue:l(n).desc,"onUpdate:modelValue":o[8]||(o[8]=e=>l(n).desc=e),rows:4,type:"textarea",placeholder:"描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","onSubmit"])])}}},ct=ee(De,[["__scopeId","data-v-a61f03e4"]]);export{ct as default};
